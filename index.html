<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes,minimum-scale=0.5,maximum-scale=3.0,viewport-fit=cover">
  <title>ë‹¤ë‹´ì—…ë¬´ê´€ë¦¬</title>
  <link rel="stylesheet" href="styles/main.css">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- PWA ì§€ì›ì„ ìœ„í•œ ë©”íƒ€ íƒœê·¸ - íšŒì „ í—ˆìš© ê°•í™” -->
  <meta name="theme-color" content="#87CEEB">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ë‹¤ë‹´í‹°ë¹„">
  
  <!-- íšŒì „ í—ˆìš©ì„ ìœ„í•œ ê°•í™”ëœ ë©”íƒ€ íƒœê·¸ -->
  <meta name="screen-orientation" content="any">
  <meta name="orientation" content="any">
  <meta name="apple-mobile-web-app-orientations" content="portrait,landscape">
  <meta name="msapplication-config" content="none">
  <meta name="format-detection" content="telephone=no">
  
  <!-- í’€ìŠ¤í¬ë¦° ì§€ì› -->
  <meta name="apple-touch-fullscreen" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  
  <!-- ì¶”ê°€ íšŒì „ ì§€ì› ë©”íƒ€ íƒœê·¸ -->
  <meta name="x5-orientation" content="portrait|landscape">
  <meta name="x5-fullscreen" content="true">
  <meta name="x5-page-mode" content="app">
  
  <!-- í„°ì¹˜ ì•„ì´ì½˜ -->
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
  
  <!-- Service Worker ë“±ë¡ ë° íšŒì „ ì§€ì› ê°•í™” -->
  <script>
    // ì¦‰ì‹œ íšŒì „ ì ê¸ˆ í•´ì œ ì‹œë„
    if ('screen' in window && screen.orientation) {
      try {
        if (typeof screen.orientation.unlock === 'function') {
          screen.orientation.unlock().catch(() => {
            console.log('íšŒì „ ì ê¸ˆ í•´ì œ ì‹œë„');
          });
        }
      } catch (e) {
        console.log('íšŒì „ ê¸°ëŠ¥ ì§€ì› í™•ì¸ ì¤‘');
      }
    }

    // Service Worker ë“±ë¡
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/service-worker.js')
          .then(function(registration) {
            console.log('Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope);
          })
          .catch(function(error) {
            console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
          });
      });
    }

    // CSS íšŒì „ ì§€ì› ê°•ì œ ì ìš©
    document.documentElement.style.setProperty('--supports-orientation', 'landscape');
    
    // ë¸Œë¼ìš°ì €ë³„ íšŒì „ ì´ë²¤íŠ¸ ê°•í™”
    function forceOrientationSupport() {
      // CSS orientation ì†ì„± ê°•ì œ ì„¤ì •
      const style = document.createElement('style');
      style.textContent = `
        @media screen and (orientation: landscape) {
          html { --orientation-check: landscape; }
        }
        @media screen and (orientation: portrait) {
          html { --orientation-check: portrait; }
        }
      `;
      document.head.appendChild(style);
      
      // ë°©í–¥ ë³€ê²½ ê°•ì œ ê°ì§€
      let lastOrientation = window.orientation || 0;
      
      function checkOrientation() {
        const currentOrientation = window.orientation || 0;
        const isLandscape = Math.abs(currentOrientation) === 90;
        
        if (currentOrientation !== lastOrientation) {
          console.log('ğŸ”„ ë°©í–¥ ë³€ê²½ ê°ì§€:', isLandscape ? 'ê°€ë¡œ' : 'ì„¸ë¡œ');
          lastOrientation = currentOrientation;
          
          // ê°•ì œ ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸ ë°œìƒ
          setTimeout(() => {
            window.dispatchEvent(new Event('resize'));
          }, 100);
        }
      }
      
      // ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ë¡œ ë°©í–¥ ê°ì§€
      window.addEventListener('orientationchange', checkOrientation);
      window.addEventListener('resize', checkOrientation);
      setInterval(checkOrientation, 500); // 0.5ì´ˆë§ˆë‹¤ ì²´í¬
    }
    
    // DOM ë¡œë“œ í›„ ì‹¤í–‰
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', forceOrientationSupport);
    } else {
      forceOrientationSupport();
    }
  </script>
</head>
<body>
  <!-- í—¤ë” ë°” -->
  <div class="header-bar">
    <span class="header-title">
      <span class="header-icon">ğŸ“‹</span>
      ë‹¤ë‹´ì—…ë¬´ê´€ë¦¬
    </span>
    <div class="header-actions">
      <button id="logoutBtn" class="logout-btn" aria-label="ë¡œê·¸ì•„ì›ƒ" style="display:none;">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </div>
  
  <!-- í™ˆ ë²„íŠ¼ (ê´€ë¦¬ìë§Œ í‘œì‹œ) -->
  <button class="home-btn" id="homeBtn" aria-label="í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°" style="display:none;">ğŸ  í™ˆ</button>

  <!-- ë¡œê·¸ì¸ ì˜ì—­ -->
  <div id="login-view">
    <div class="box login-container">
      <h3>ë¡œê·¸ì¸</h3>
      <form id="login-form" onsubmit="return false;" autocomplete="on">
        <input 
          type="email" 
          id="email" 
          placeholder="ì´ë©”ì¼" 
          required 
          aria-label="ì´ë©”ì¼ ì…ë ¥"
          autocomplete="email"
          inputmode="email"
        >
        <input 
          type="password" 
          id="password" 
          placeholder="ë¹„ë°€ë²ˆí˜¸" 
          required 
          aria-label="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
          autocomplete="current-password"
        >
        <button id="loginBtn" type="button" aria-label="ë¡œê·¸ì¸í•˜ê¸°">ë¡œê·¸ì¸</button>
      </form>
      
      <!-- ë¡œë”© ìƒíƒœ í‘œì‹œ -->
      <div id="login-loading" style="display:none; text-align:center; margin-top:15px;">
        <div class="spinner" style="width:30px; height:30px; margin:0 auto 10px;"></div>
        <p style="margin:0; color:#666; font-size:14px;">ë¡œê·¸ì¸ ì¤‘...</p>
      </div>
    </div>
  </div>

  <!-- ë©”ì¸ ì˜ì—­ -->
  <div id="main-view" style="display:none;">
    <!-- ê´€ë¦¬ììš© í™ˆ ë²„íŠ¼ ê·¸ë¦¬ë“œ -->
    <div id="home-buttons" class="button-grid" style="display:none;">
      <button class="menu-button" id="task-btn" aria-label="ì‘ì—…ì§€ì‹œ ê´€ë¦¬">
        ğŸ“‹<br><span style="margin-top:8px; display:block;">ì‘ì—…ì§€ì‹œ</span>
      </button>
      <button class="menu-button" id="reserve-btn" aria-label="ì˜ˆì•½ ê´€ë¦¬">
        ğŸ“…<br><span style="margin-top:8px; display:block;">ì˜ˆì•½</span>
      </button>
      <button class="menu-button" id="settle-btn" aria-label="ì •ì‚° ê´€ë¦¬">
        ğŸ’°<br><span style="margin-top:8px; display:block;">ì •ì‚°</span>
      </button>
      <button class="menu-button" id="company-funds-btn" aria-label="íšŒì‚¬ìš´ì˜ë¹„ ê´€ë¦¬">
        ğŸ’¸<br><span style="margin-top:8px; display:block;">íšŒì‚¬ìš´ì˜ë¹„</span>
      </button>
      <button class="menu-button" id="inventory-btn" aria-label="ì…ì¶œê³  ê´€ë¦¬">
        ğŸ“¦<br><span style="margin-top:8px; display:block;">ì…ì¶œê³ </span>
      </button>
      <button class="menu-button" id="print-workorder-btn" aria-label="ì‘ì—…ì§€ì‹œì„œ ì¸ì‡„">
        ğŸ–¨ï¸<br><span style="margin-top:8px; display:block;">ì‘ì—…ì§€ì‹œì„œ ì¸ì‡„</span>
      </button>
      <button class="menu-button" id="holiday-btn" aria-label="íœ´ë¬´ ê´€ë¦¬">
        ğŸ–ï¸<br><span style="margin-top:8px; display:block;">íœ´ë¬´ê´€ë¦¬</span>
      </button>
    </div>
    
    <!-- íƒ­ ì»¨í…ì¸  ì˜ì—­ -->
    <div id="tab-content" style="display:none;">
      <div id="tab-title"></div>
      <div id="tab-body"></div>
    </div>
  </div>

  <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ (ì „ì—­) -->
  <div id="loading-spinner" style="display:none;" role="status" aria-live="polite">
    <div class="spinner"></div>
    <p>ë¡œë”© ì¤‘...</p>
  </div>

  <!-- ì—ëŸ¬/ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
  <div id="error-message" style="display:none;" role="alert" aria-live="assertive"></div>

  <!-- ì˜¤í”„ë¼ì¸ ìƒíƒœ ì•Œë¦¼ -->
  <div id="offline-banner" style="display:none;" class="offline-banner">
    <span>ğŸ“¶ ì˜¤í”„ë¼ì¸ ìƒíƒœì…ë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</span>
  </div>

  <!-- ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© (ìµœì í™”ëœ ìˆœì„œ) -->
  <!-- 1. ê¸°ë³¸ ì„¤ì • ë° ìœ í‹¸ë¦¬í‹° -->
  <script type="module" src="scripts/firebase-config.js"></script>
  
  <!-- 2. ë°ì´í„° ëª¨ë¸ -->
  <script type="module" src="scripts/parts-list.js"></script>

  <!-- 3. í…œí”Œë¦¿ (UI ë¨¼ì €) -->
  <script type="module" src="scripts/templates/inventory-templates.js"></script>

  <!-- 4. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ -->
  <script type="module" src="scripts/task-save.js"></script>
  <script type="module" src="scripts/settle.js"></script>
  <script type="module" src="scripts/backup.js"></script>
  <script type="module" src="scripts/inventory.js"></script>
  <script type="module" src="scripts/company-funds.js"></script>

  <!-- 5. ì‘ì—…ì§€ì‹œì„œ ì¸ì‡„ ëª¨ë“ˆ ì¶”ê°€ -->
  <script type="module" src="scripts/print-work-orders.js"></script>

  <!-- 6. UI ì»¨íŠ¸ë¡¤ëŸ¬ -->
  <script type="module" src="scripts/task-ui.js"></script>

  <!-- 7. ì¸ì¦ (ë§ˆì§€ë§‰) -->
  <script type="module" src="scripts/auth.js"></script>

  <!-- ğŸ”§ ìºì‹œ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // ê°œë°œìš© ìºì‹œ ì‚­ì œ í•¨ìˆ˜
    window.clearAllCache = async function() {
      try {
        console.log('ğŸ§¹ ëª¨ë“  ìºì‹œ ì‚­ì œ ì‹œì‘...');
        
        // Service Workerì—ê²Œ ìºì‹œ ì‚­ì œ ìš”ì²­
        if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
          const messageChannel = new MessageChannel();
          
          return new Promise((resolve) => {
            messageChannel.port1.onmessage = function(event) {
              if (event.data.success) {
                console.log('âœ… Service Worker ìºì‹œ ì‚­ì œ ì™„ë£Œ');
                resolve();
              }
            };
            
            navigator.serviceWorker.controller.postMessage(
              {type: 'CLEAR_CACHE'}, 
              [messageChannel.port2]
            );
          });
        }
        
        // ë¸Œë¼ìš°ì € ìºì‹œë„ ì‚­ì œ
        if ('caches' in window) {
          const cacheNames = await caches.keys();
          await Promise.all(
            cacheNames.map(cacheName => {
              console.log('ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ:', cacheName);
              return caches.delete(cacheName);
            })
          );
        }
        
        console.log('âœ… ëª¨ë“  ìºì‹œ ì‚­ì œ ì™„ë£Œ!');
        alert('ìºì‹œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
        window.location.reload(true);
        
      } catch (error) {
        console.error('âŒ ìºì‹œ ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ìºì‹œ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    };

    // ê°œë°œìš© Service Worker ì¬ë“±ë¡ í•¨ìˆ˜
    window.reregisterServiceWorker = async function() {
      try {
        if ('serviceWorker' in navigator) {
          // ê¸°ì¡´ Service Worker í•´ì œ
          const registrations = await navigator.serviceWorker.getRegistrations();
          for (let registration of registrations) {
            await registration.unregister();
            console.log('Service Worker í•´ì œ:', registration.scope);
          }
          
          // ìƒˆë¡œ ë“±ë¡
          const registration = await navigator.serviceWorker.register('/service-worker.js');
          console.log('Service Worker ì¬ë“±ë¡ ì„±ê³µ:', registration.scope);
          
          alert('Service Workerê°€ ì¬ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
          window.location.reload(true);
        }
      } catch (error) {
        console.error('Service Worker ì¬ë“±ë¡ ì˜¤ë¥˜:', error);
        alert('Service Worker ì¬ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    };

    // ì½˜ì†”ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì•ˆë‚´
    console.log(`
ğŸ”§ ê°œë°œìš© ìºì‹œ ê´€ë¦¬ í•¨ìˆ˜:
  - clearAllCache() : ëª¨ë“  ìºì‹œ ì‚­ì œ
  - reregisterServiceWorker() : Service Worker ì¬ë“±ë¡
    `);

    // ê°œë°œ ëª¨ë“œì—ì„œ ìë™ìœ¼ë¡œ ìºì‹œ ë¬´ì‹œ (ì„ íƒì‚¬í•­)
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
      console.log('ğŸ”§ ê°œë°œ ëª¨ë“œ - ìºì‹œ ì •ì±… ìˆ˜ì •');
    }
  </script>

  <!-- ë©”ì¸ ì•± ë¡œì§ -->
  <script>
    // ì „ì—­ í•¨ìˆ˜ ì •ì˜ (ì¸ë¼ì¸ìœ¼ë¡œ ì •ì˜í•˜ì—¬ onclick ì´ë²¤íŠ¸ì—ì„œ ì‚¬ìš© ê°€ëŠ¥)
    function backToHome() {
      console.log('ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°');
      const tabContent = document.getElementById('tab-content');
      const homeButtons = document.getElementById('home-buttons');
      
      if (tabContent) tabContent.style.display = 'none';
      if (homeButtons) homeButtons.style.display = 'grid';
    }
    
    function openTab(name) {
      console.log('ğŸ“‚ íƒ­ ì—´ê¸°:', name);
      
      // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
      if (window.isCurrentUserAdmin && !window.isCurrentUserAdmin()) {
        console.log('âŒ ì‘ì—…ìëŠ” íƒ­ ì´ë™ ë¶ˆê°€');
        return;
      }
      
      const homeButtons = document.getElementById('home-buttons');
      const tabContent = document.getElementById('tab-content');
      
      if (homeButtons) homeButtons.style.display = 'none';
      if (tabContent) tabContent.style.display = 'block';
      
      // íƒ­ ì œëª© ì„¤ì •
      const tabTitleElement = document.getElementById('tab-title');
      if (tabTitleElement) {
        let titleText = '';
        let titleIcon = '';
        
        switch(name) {
          case 'task':
            titleText = 'ì‘ì—…ì§€ì‹œ';
            titleIcon = 'ğŸ“‹';
            break;
          case 'reserve':
            titleText = 'ì˜ˆì•½';
            titleIcon = 'ğŸ“…';
            break;
          case 'settle':
            titleText = 'ì •ì‚°';
            titleIcon = 'ğŸ’°';
            break;
          case 'company-funds':
            titleText = 'íšŒì‚¬ìš´ì˜ë¹„';
            titleIcon = 'ğŸ’¸';
            break;
          case 'inventory':
            titleText = 'ì…ì¶œê³ ';
            titleIcon = 'ğŸ“¦';
            break;
          case 'print-workorder':
            titleText = 'ì‘ì—…ì§€ì‹œì„œ ì¸ì‡„';
            titleIcon = 'ğŸ–¨ï¸';
            break;
          case 'holiday':
            titleText = 'íœ´ë¬´ê´€ë¦¬';
            titleIcon = 'ğŸ–ï¸';
            break;
        }
        
        tabTitleElement.innerHTML = `
          <div style="
            background: white;
            padding: 20px 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            text-align: center;
            border-left: 4px solid #8ecae6;
          ">
            <h3 style="
              margin: 0;
              font-size: 1.4rem;
              color: #333;
              font-weight: 600;
            ">${titleIcon} ${titleText}</h3>
          </div>
        `;
      }
      
      // íƒ­ë³„ ë¡œì§ ì‹¤í–‰
      if (name === 'task' && window.showTaskTab) {
        window.showTaskTab('check');
      } else if (name === 'reserve' && window.loadReserveTasks) {
        window.loadReserveTasks();
      } else if (name === 'settle' && window.loadSettlement) {
        const tabBody = document.getElementById('tab-body');
        if (tabBody) {
          tabBody.innerHTML = '<div id="settle-result"></div>';
          window.loadSettlement();
        }
      } else if (name === 'company-funds' && window.loadCompanyFunds) {
        window.loadCompanyFunds();
      } else if (name === 'inventory' && window.loadInventoryManagement) {
        window.loadInventoryManagement();
      } else if (name === 'print-workorder' && window.loadWorkOrderPrint) {
        // ì‘ì—…ì§€ì‹œì„œ ì¸ì‡„ íƒ­ ë¡œë“œ
        window.loadWorkOrderPrint();
      }
    }

    // íšŒì‚¬ìš´ì˜ë¹„ ì „ìš© í•¨ìˆ˜ (ì§ì ‘ í˜¸ì¶œìš©)
    function loadCompanyFundsTab() {
      console.log('ğŸ’¸ íšŒì‚¬ìš´ì˜ë¹„ ì§ì ‘ ë¡œë“œ');
      
      // í™”ë©´ ì „í™˜
      const homeButtons = document.getElementById('home-buttons');
      const tabContent = document.getElementById('tab-content');
      
      if (homeButtons) homeButtons.style.display = 'none';
      if (tabContent) tabContent.style.display = 'block';
      
      // ì œëª© ì„¤ì •
      const tabTitleElement = document.getElementById('tab-title');
      if (tabTitleElement) {
        tabTitleElement.innerHTML = `
          <div style="
            background: white;
            padding: 20px 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            text-align: center;
            border-left: 4px solid #8ecae6;
          ">
            <h3 style="
              margin: 0;
              font-size: 1.4rem;
              color: #333;
              font-weight: 600;
            ">ğŸ’¸ íšŒì‚¬ìš´ì˜ë¹„</h3>
          </div>
        `;
      }
      
      // ë‚´ìš© ë¡œë“œ
      if (window.loadCompanyFunds) {
        console.log('ğŸ’¸ loadCompanyFunds ì‹¤í–‰');
        window.loadCompanyFunds();
      } else {
        console.error('âŒ loadCompanyFunds í•¨ìˆ˜ ì—†ìŒ');
      }
    }

    // ì‘ì—…ì§€ì‹œì„œ ì¸ì‡„ ì „ìš© í•¨ìˆ˜ (ì§ì ‘ í˜¸ì¶œìš©)
    function loadPrintWorkOrderTab() {
      console.log('ğŸ–¨ï¸ ì‘ì—…ì§€ì‹œì„œ ì¸ì‡„ ì§ì ‘ ë¡œë“œ');
      
      // í™”ë©´ ì „í™˜
      const homeButtons = document.getElementById('home-buttons');
      const tabContent = document.getElementById('tab-content');
      
      if (homeButtons) homeButtons.style.display = 'none';
      if (tabContent) tabContent.style.display = 'block';
      
      // ì œëª© ì„¤ì •
      const tabTitleElement = document.getElementById('tab-title');
      if (tabTitleElement) {
        tabTitleElement.innerHTML = `
          <div style="
            background: white;
            padding: 20px 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            text-align: center;
            border-left: 4px solid #8ecae6;
          ">
            <h3 style="
              margin: 0;
              font-size: 1.4rem;
              color: #333;
              font-weight: 600;
            ">ğŸ–¨ï¸ ì‘ì—…ì§€ì‹œì„œ ì¸ì‡„</h3>
          </div>
        `;
      }
      
      // ë‚´ìš© ë¡œë“œ
      if (window.loadWorkOrderPrint) {
        console.log('ğŸ–¨ï¸ loadWorkOrderPrint ì‹¤í–‰');
        window.loadWorkOrderPrint();
      } else {
        console.error('âŒ loadWorkOrderPrint í•¨ìˆ˜ ì—†ìŒ');
      }
    }

    // DOMì´ ë¡œë“œëœ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    document.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸ“± DOM ë¡œë“œ ì™„ë£Œ');
      
      // í™ˆ ë²„íŠ¼ ì´ë²¤íŠ¸
      const homeBtn = document.getElementById('homeBtn');
      if (homeBtn) {
        homeBtn.addEventListener('click', backToHome);
      }
      
      // ë©”ë‰´ ë²„íŠ¼ë“¤ ì´ë²¤íŠ¸ - í™•ì‹¤í•œ ì—°ê²°ì„ ìœ„í•´ ì§€ì—° ì¶”ê°€
      setTimeout(() => {
        const taskBtn = document.getElementById('task-btn');
        const reserveBtn = document.getElementById('reserve-btn');
        const settleBtn = document.getElementById('settle-btn');
        const companyFundsBtn = document.getElementById('company-funds-btn');
        const inventoryBtn = document.getElementById('inventory-btn');
        const printWorkOrderBtn = document.getElementById('print-workorder-btn');
        const holidayBtn = document.getElementById('holiday-btn');
        
        if (taskBtn) {
          taskBtn.addEventListener('click', () => openTab('task'));
          console.log('âœ… ì‘ì—…ì§€ì‹œ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°');
        }
        if (reserveBtn) {
          reserveBtn.addEventListener('click', () => openTab('reserve'));
          console.log('âœ… ì˜ˆì•½ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°');
        }
        if (settleBtn) {
          settleBtn.addEventListener('click', () => openTab('settle'));
          console.log('âœ… ì •ì‚° ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°');
        }
        if (companyFundsBtn) {
          // íšŒì‚¬ìš´ì˜ë¹„ëŠ” ì „ìš© í•¨ìˆ˜ ì‚¬ìš©
          companyFundsBtn.addEventListener('click', loadCompanyFundsTab);
          console.log('âœ… íšŒì‚¬ìš´ì˜ë¹„ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°');
        }
        if (inventoryBtn) {
          inventoryBtn.addEventListener('click', () => openTab('inventory'));
          console.log('âœ… ì…ì¶œê³  ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°');
        }
        if (printWorkOrderBtn) {
          // ì‘ì—…ì§€ì‹œì„œ ì¸ì‡„ëŠ” ì „ìš© í•¨ìˆ˜ ì‚¬ìš©
          printWorkOrderBtn.addEventListener('click', loadPrintWorkOrderTab);
          console.log('âœ… ì‘ì—…ì§€ì‹œì„œ ì¸ì‡„ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°');
        }
        if (holidayBtn) {
          holidayBtn.addEventListener('click', () => openTab('holiday'));
          console.log('âœ… íœ´ë¬´ê´€ë¦¬ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°');
        }
      }, 300);
      
      // ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ìƒíƒœ ê°ì§€
      function updateOnlineStatus() {
        const offlineBanner = document.getElementById('offline-banner');
        if (offlineBanner) {
          if (navigator.onLine) {
            offlineBanner.style.display = 'none';
          } else {
            offlineBanner.style.display = 'block';
          }
        }
      }

      window.addEventListener('online', updateOnlineStatus);
      window.addEventListener('offline', updateOnlineStatus);
      updateOnlineStatus();

      // iOS Safari 100vh ì´ìŠˆ í•´ê²° ë° íšŒì „ ê°ì§€ ê°•í™”
      function setViewportHeight() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
        
        // ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ë°©í–¥ ê°ì§€
        const isLandscape = window.innerWidth > window.innerHeight || 
                           Math.abs(window.orientation || 0) === 90 ||
                           window.matchMedia('(orientation: landscape)').matches;
        
        if (isLandscape) {
          document.body.classList.add('landscape-mode');
          document.body.classList.remove('portrait-mode');
          document.documentElement.classList.add('landscape-mode');
          console.log('ğŸ”„ ê°€ë¡œëª¨ë“œ í™œì„±í™” - í¬ê¸°:', window.innerWidth, 'x', window.innerHeight);
        } else {
          document.body.classList.add('portrait-mode');
          document.body.classList.remove('landscape-mode');
          document.documentElement.classList.remove('landscape-mode');
          console.log('ğŸ”„ ì„¸ë¡œëª¨ë“œ í™œì„±í™” - í¬ê¸°:', window.innerWidth, 'x', window.innerHeight);
        }
        
        // ê°•ì œ ë¦¬í”Œë¡œìš°
        document.body.style.height = '100vh';
        setTimeout(() => {
          document.body.style.height = '';
        }, 100);
      }
      
      // ì¦‰ì‹œ ì‹¤í–‰
      setViewportHeight();
      
      // ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ë¡œ ê°ì§€
      window.addEventListener('resize', () => {
        clearTimeout(window.orientationTimer);
        window.orientationTimer = setTimeout(setViewportHeight, 50);
      });
      
      // orientationchange ì´ë²¤íŠ¸ (ëª¨ë°”ì¼ íšŒì „) - ê°•í™”
      window.addEventListener('orientationchange', () => {
        console.log('ğŸ“± orientationchange ì´ë²¤íŠ¸:', window.orientation);
        setTimeout(setViewportHeight, 100);
        setTimeout(setViewportHeight, 300);
        setTimeout(setViewportHeight, 500); // ì¶”ê°€ ì•ˆì „ì¥ì¹˜
      });

      // í™”ë©´ ë°©í–¥ API ì‚¬ìš© (ìµœì‹  ë¸Œë¼ìš°ì €) - ê°•í™”
      if (screen.orientation) {
        screen.orientation.addEventListener('change', () => {
          console.log('ğŸ“± Screen Orientation API ë³€ê²½:', screen.orientation.angle, screen.orientation.type);
          setTimeout(setViewportHeight, 100);
          setTimeout(setViewportHeight, 300);
        });
      }

      // ë¯¸ë””ì–´ ì¿¼ë¦¬ë¡œ ë°©í–¥ ê°ì§€ (ì¶”ê°€ ì•ˆì „ì¥ì¹˜) - ê°•í™”
      const orientationMQ = window.matchMedia('(orientation: landscape)');
      orientationMQ.addEventListener('change', (e) => {
        console.log('ğŸ“± ë¯¸ë””ì–´ ì¿¼ë¦¬ ë°©í–¥ ë³€ê²½:', e.matches ? 'ê°€ë¡œ' : 'ì„¸ë¡œ');
        setTimeout(setViewportHeight, 100);
        setTimeout(setViewportHeight, 300);
      });

      // ì¶”ê°€: ë·°í¬íŠ¸ í¬ê¸° ë³€ê²½ ê°ì§€
      const resizeObserver = new ResizeObserver(() => {
        setTimeout(setViewportHeight, 50);
      });
      resizeObserver.observe(document.documentElement);

      // íšŒì „ ì ê¸ˆ í•´ì œ ìš”ì²­ (ìµœì‹  ë¸Œë¼ìš°ì €) - ê°•í™”
      if ('screen' in window && screen.orientation && typeof screen.orientation.unlock === 'function') {
        try {
          screen.orientation.unlock().then(() => {
            console.log('âœ… í™”ë©´ íšŒì „ ì ê¸ˆ í•´ì œ ì„±ê³µ');
          }).catch(err => {
            console.log('ğŸ”„ í™”ë©´ íšŒì „ ì ê¸ˆ í•´ì œ ì‹¤íŒ¨ (ì •ìƒ):', err.message);
          });
        } catch (err) {
          console.log('ğŸ”„ íšŒì „ ì ê¸ˆ í•´ì œ ì§€ì› ì•ˆí•¨ (ì •ìƒ):', err.message);
        }
      }

      // ê°•ì œ íšŒì „ ì§€ì› ì²´í¬ (ë””ë²„ê¹…ìš©)
      setTimeout(() => {
        console.log('ğŸ” í˜„ì¬ í™”ë©´ ì •ë³´:');
        console.log('- í¬ê¸°:', window.innerWidth, 'x', window.innerHeight);
        console.log('- orientation:', window.orientation);
        console.log('- matchMedia landscape:', window.matchMedia('(orientation: landscape)').matches);
        console.log('- screen.orientation:', screen.orientation?.type);
        console.log('- ê°ì§€ëœ ëª¨ë“œ:', document.body.classList.contains('landscape-mode') ? 'ê°€ë¡œ' : 'ì„¸ë¡œ');
      }, 1000);

      // í„°ì¹˜ ìŠ¤í¬ë¡¤ ê°œì„  (iOS)
      document.body.style.webkitOverflowScrolling = 'touch';
      
      // íƒ­ í•˜ì´ë¼ì´íŠ¸ ì œê±° (Android)
      document.body.style.webkitTapHighlightColor = 'transparent';
      
      // í‚¤ë³´ë“œ ëŒ€ì‘ (ëª¨ë°”ì¼ì—ì„œ input focus ì‹œ ìŠ¤í¬ë¡¤ ì¡°ì •)
      const inputs = document.querySelectorAll('input, textarea, select');
      inputs.forEach(input => {
        input.addEventListener('focus', () => {
          setTimeout(() => {
            input.scrollIntoView({ 
              behavior: 'smooth', 
              block: 'center' 
            });
          }, 300);
        });
      });

      // ìƒíƒœë°” ë†’ì´ ê°ì§€ (iOS)
      if (window.navigator.standalone) {
        document.body.classList.add('standalone');
      }
    });

    // ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ê°ì§€
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden && window.auth?.currentUser) {
        console.log('ì•± ë‹¤ì‹œ í™œì„±í™” - ë°ì´í„° ìƒˆë¡œê³ ì¹¨');
        
        const activeTab = document.querySelector('.worker-tab-btn.active');
        if (activeTab) {
          if (activeTab.id === 'today-tab' && window.loadWorkerTodayTasks) {
            window.loadWorkerTodayTasks();
          } else if (activeTab.id === 'done-tab' && window.loadWorkerDoneTasks) {
            window.loadWorkerDoneTasks();
          }
        } else if (window.isCurrentUserAdmin && window.isCurrentUserAdmin()) {
          if (window.loadTodayTasks) {
            window.loadTodayTasks();
          }
        }
      }
    });

    // ì „ì—­ ì—ëŸ¬ ì²˜ë¦¬
    window.addEventListener('error', (event) => {
      console.error('ì „ì—­ ì—ëŸ¬:', event.error);
      // íŠ¹ì • ì—ëŸ¬ëŠ” ë¬´ì‹œ (ê°œë°œ í™˜ê²½)
      if (event.error && event.error.message && 
          (event.error.message.includes('backToHome') || 
           event.error.message.includes('openTab') ||
           event.error.message.includes('Live reload'))) {
        return; // ê°œë°œ ì„œë²„ ê´€ë ¨ ì—ëŸ¬ ë¬´ì‹œ
      }
    });

    window.addEventListener('unhandledrejection', (event) => {
      console.error('ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ê±°ë¶€:', event.reason);
      event.preventDefault();
    });
    
    // ì „ì—­ í•¨ìˆ˜ë¥¼ windowì— ë“±ë¡
    window.backToHome = backToHome;
    window.openTab = openTab;
    window.loadCompanyFundsTab = loadCompanyFundsTab;
    window.loadPrintWorkOrderTab = loadPrintWorkOrderTab;
  </script>

  <!-- PWA ë° ëª¨ë°”ì¼ ì „ìš© ìŠ¤íƒ€ì¼ -->
  <style>
    /* ì˜¤í”„ë¼ì¸ ë°°ë„ˆ */
    .offline-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #dc3545;
      color: white;
      padding: 10px 20px;
      text-align: center;
      font-size: 0.9rem;
      font-weight: 600;
      z-index: 1001;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    /* ìŠ¤íƒ ë“œì–¼ë¡  ëª¨ë“œ (PWA) ìŠ¤íƒ€ì¼ */
    .standalone {
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* í‚¤ë³´ë“œ ëŒ€ì‘ */
    @media screen and (max-height: 500px) {
      .header-bar {
        padding: 10px 20px;
      }
      
      .box {
        padding: 15px;
      }
      
      .menu-button {
        padding: 20px 8px;
        font-size: 16px;
        min-height: 80px;
      }
    }

    /* ì ‘ê·¼ì„±: ëª¨ì…˜ ê°ì†Œ ì„¤ì • */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      
      .task-item:hover {
        transform: none;
      }
      
      button:hover {
        transform: none;
      }
    }

    /* CSS ì‚¬ìš©ì ì •ì˜ ì†ì„± */
    :root {
      --vh: 1vh;
      --safe-area-inset-top: env(safe-area-inset-top);
      --safe-area-inset-bottom: env(safe-area-inset-bottom);
    }

    /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #219ebc;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ì—ëŸ¬ ë©”ì‹œì§€ */
    #error-message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #dc3545;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      font-weight: 600;
      max-width: 90%;
      text-align: center;
    }

    #error-message.success {
      background: #28a745;
    }

    #error-message.show {
      display: block !important;
    }

    /* ë¡œë”© ìŠ¤í”¼ë„ˆ ì „ì—­ */
    #loading-spinner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.9);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    #loading-spinner p {
      margin-top: 20px;
      color: #666;
      font-size: 16px;
      font-weight: 600;
    }

    /* ë°©í–¥ë³„ ìµœì í™” í´ë˜ìŠ¤ - ê°•í™” */
    .landscape-mode .header-bar {
      min-height: 45px;
      padding: 8px 20px;
    }

    .landscape-mode .header-title {
      font-size: 1.1rem;
    }

    .landscape-mode .logout-btn,
    .landscape-mode .home-btn {
      min-width: 70px;
      font-size: 0.85rem;
      padding: 6px 12px;
      min-height: 32px;
    }

    .landscape-mode .button-grid {
      margin-top: 20px;
      gap: 12px;
    }

    .landscape-mode .menu-button {
      font-size: 14px;
      padding: 20px 8px;
      min-height: 70px;
    }

    .portrait-mode .header-bar {
      min-height: 60px;
      padding: 15px 25px;
    }

    .portrait-mode .header-title {
      font-size: 1.4rem;
    }

    .portrait-mode .logout-btn,
    .portrait-mode .home-btn {
      min-width: 100px;
      font-size: 1rem;
      padding: 12px 20px;
      min-height: 45px;
    }

    .portrait-mode .button-grid {
      margin-top: 40px;
      gap: 20px;
    }

    .portrait-mode .menu-button {
      font-size: 22px;
      padding: 40px 12px;
      min-height: 120px;
    }

    /* ê°•ì œ ê°€ë¡œëª¨ë“œ ì§€ì› */
    html.landscape-mode,
    html.landscape-mode body {
      --orientation: landscape;
    }

    /* íšŒì „ ë””ë²„ê·¸ ì •ë³´ */
    .orientation-debug {
      position: fixed;
      top: 50px;
      right: 10px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 12px;
      z-index: 10000;
      display: none;
    }

    /* ê°œë°œ ëª¨ë“œì—ì„œë§Œ ë””ë²„ê·¸ ì •ë³´ í‘œì‹œ */
    body[data-debug="true"] .orientation-debug {
      display: block;
    }

    /* ê°€ë¡œëª¨ë“œ ì „ìš© ìŠ¤íƒ€ì¼ */
    @media screen and (orientation: landscape) {
      body {
        padding: 10px 15px;
        font-size: 16px;
      }

      .box {
        padding: 18px 20px;
        margin-bottom: 15px;
      }

      .login-container {
        max-width: 400px;
        margin: 20px auto;
      }

      .login-container h3 {
        font-size: 1.4rem;
        margin-bottom: 20px;
      }

      input, textarea, select, button {
        padding: 12px 15px;
        font-size: 16px;
        min-height: 44px;
      }

      .worker-subtabs {
        gap: 15px;
        padding: 0 10px;
        margin-bottom: 15px;
      }

      .worker-tab-btn {
        padding: 10px 15px;
        font-size: 14px;
        min-height: 38px;
      }

      .task-summary {
        padding: 15px 20px;
        min-height: 60px;
        font-size: 15px;
      }

      .task-date-mobile {
        font-size: 15px;
        margin-bottom: 4px;
      }

      .task-info-mobile {
        font-size: 16px;
        gap: 8px;
        margin-bottom: 4px;
      }

      .task-worker-mobile, .task-client-mobile {
        font-size: 16px;
        padding: 2px 8px;
      }

      .task-type-mobile, .task-content-mobile {
        font-size: 16px;
      }

      .task-summary .arrow {
        font-size: 20px;
        right: 20px;
      }

      /* ìŠ¤í¬ë¡¤ ìµœì í™” */
      .task-list {
        max-height: calc(100vh - 200px);
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }

      #tab-body {
        max-height: calc(100vh - 150px);
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }

      /* ìˆ˜í‰ ìŠ¤í¬ë¡¤ ë°©ì§€ */
      body {
        overflow-x: hidden;
      }
    }

    /* ê·¹ì†Œí˜• ê°€ë¡œëª¨ë“œ (í‚¤ë³´ë“œ í‘œì‹œ ì‹œ) */
    @media screen and (orientation: landscape) and (max-height: 400px) {
      .header-bar {
        padding: 5px 15px;
        min-height: 35px;
        margin-bottom: 10px;
      }

      .header-title {
        font-size: 1rem;
      }

      .logout-btn, .home-btn {
        font-size: 0.8rem;
        padding: 4px 8px;
        min-height: 28px;
        min-width: 60px;
      }

      body {
        padding: 8px 12px;
      }

      .box {
        padding: 12px 15px;
        margin-bottom: 10px;
      }

      input, textarea, select, button {
        padding: 8px 12px;
        font-size: 14px;
        min-height: 36px;
      }

      .worker-tab-btn {
        padding: 6px 8px;
        font-size: 13px;
        min-height: 32px;
      }

      .task-summary {
        padding: 10px 15px;
        min-height: 45px;
        font-size: 14px;
      }
    }

    /* íƒœë¸”ë¦¿ ê°€ë¡œëª¨ë“œ */
    @media screen and (orientation: landscape) and (min-width: 768px) {
      body {
        padding: 15px 25px;
      }

      .button-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-top: 30px;
        max-width: 800px;
      }

      .menu-button {
        font-size: 16px;
        padding: 25px 10px;
        min-height: 85px;
      }

      .task-list {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin: 25px 0;
      }

      .task-item {
        margin-bottom: 0;
      }

      .worker-subtabs {
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        gap: 20px;
      }

      .worker-tab-btn {
        padding: 14px 20px;
        font-size: 16px;
        min-height: 48px;
      }

      .task-subtabs {
        max-width: 800px;
        gap: 20px;
      }

      .task-subtabs button {
        padding: 16px 18px;
        font-size: 16px;
        min-height: 52px;
      }
    }

    /* ëŒ€í˜• íƒœë¸”ë¦¿ ê°€ë¡œëª¨ë“œ */
    @media screen and (orientation: landscape) and (min-width: 1024px) {
      body {
        padding: 20px 40px;
      }

      .button-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 25px;
        max-width: 900px;
      }

      .menu-button {
        font-size: 18px;
        padding: 30px 15px;
        min-height: 100px;
      }

      .task-list {
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
      }

      /* ë°ìŠ¤í¬íƒ‘ ìŠ¤íƒ€ì¼ë¡œ ì „í™˜ */
      .task-summary-mobile {
        display: none;
      }

      .col-date, .col-staff, .col-client, .col-tasktype, .col-content {
        display: block;
      }

      .task-summary {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 15px;
        padding: 20px 25px;
        min-height: 70px;
      }
    }

    /* í´ë”ë¸” í° ëŒ€ì‘ */
    @media screen and (orientation: landscape) and (min-width: 600px) and (max-width: 900px) {
      .button-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
      }

      .menu-button {
        font-size: 15px;
        padding: 22px 8px;
        min-height: 75px;
      }

      .task-list {
        grid-template-columns: 1fr;
      }
    }

    /* iOS Safari ëŒ€ì‘ */
    @supports (-webkit-appearance: none) {
      @media screen and (orientation: landscape) {
        body {
          min-height: calc(var(--vh, 1vh) * 100);
        }
      }
    }

    /* ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ */
    .landscape-only {
      display: none;
    }

    @media screen and (orientation: landscape) {
      .landscape-only {
        display: block;
      }
      
      .portrait-only {
        display: none;
      }
    }

    /* í„°ì¹˜ ìµœì í™” */
    * {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }

    input, textarea {
      -webkit-user-select: text;
      user-select: text;
    }

    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ (Webkit) */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb {
      background: #8ecae6;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #219ebc;
    }
  </style>

</body>
</html>